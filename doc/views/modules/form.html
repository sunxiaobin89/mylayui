<h1 class="site-h1"><i class="layui-icon layui-icon-form"></i> 表单模块文档 - layui.form</h1>
<blockquote class="layui-elem-quote">
  针对form组件使用的过程遇到的问题对其进行的几处修改
</blockquote>

<fieldset class="layui-elem-field layui-field-title">
  <legend>功能加强</legend>
</fieldset>

<div class="site-text">
  <p>1. 让form.render具备更细粒度的渲染能力。</p>

  <blockquote class="layui-elem-quote layui-quote-nm">
    <p>目前form.render有两个参数：第一个是类型type，支持单独渲染某种类型的，第二个参数是filter，也就是要渲染的是哪些表单里面的节点。</p>
    <p>所以目前基本上最小的粒度就是渲染某个表单内的某种类型的表单元素，那么如果有一些节点比如下拉他的选项是异步获取的，那么回来之后如何只渲染这个节点而不会影响到这个表单的其他元素，原始的form.render不好处理，有个比较可以实现的方法就是给每个表单元素的容器都加上layui-form并且每个都有自己独特的lay-filter，但是这样是十分不建议的，会出现表单嵌套，而且也是巨麻烦，之前写tablePlug的时候也用过一个处理，就是取巧的修改form.render的源码新增一个第三参数，传入要渲染的jquery对象，内部实现就是给要渲染的对象的父容器临时的加上class:lay-form和属性lay-filter,再调用原始的form.render去渲染，渲染完成之后去掉之前临时添加的class和属性，初步的实现了更细粒度的更新，但是缺点就是如果被渲染的表单元素有其他的兄弟节点，一样会被影响到，所以还是没有完全的达到“指哪打哪”。</p>
  </blockquote>
  <blockquote class="layui-elem-quote layui-quote-nm">
    <p>那么mylayui如何实现？</p>
    <p>目前的策略是：将第一个参数新增一个jquery对象的支持，原始的参数type一般就是字符串，指定渲染某种类型，或者null，渲染全部的类型，目前除了这两种之外新增一种就是可传入一个jquery对象，后面会遍历这个对象，判断节点的类型，找到对应的渲染逻辑逐个渲染，那么这种情况下是不需要第二个参数filter的，因为已经都定位到特定的要渲染的节点了，form的filter加上是没有意义的，当然加上不会出错，只不过这种情况下参数会被无视。</p>
  </blockquote>
  <pre class="layui-code" lay-title="html" lay-encode="true">
// 对某个节点修改之后重新渲染
$('select#address').html('<option value="Mars">火星</option><option value="Earth">地球</option>');
form.render($('select#address'));
// 修改一批特定的节点
form.render($('.test'))</pre>
</div>

<script>
  layui.use('code', function () {
    var code = layui.code;
    code();
  })
</script>

<div class="site-text">
  <p>2. 让form.val功能更全面。（取值）</p>

  <blockquote class="layui-elem-quote layui-quote-nm">
    <p>目前form.val一般是用来赋值的，虽然layui官网称之为初始赋值，但是个人的看法是这个方法不能称之为初始赋值，初始给人的感觉就是点击重置可以回到这个状态，这样子的赋值才能称之为初始，比如修改一条table的记录，表单初始赋值之后，用户操作了一些信息，之后发现忘了修改了什么了不确定是否真的要提交，想回到原始的填写之前的状态，那么利用form的reset的功能希望回到之前初始的状态，那么form.val是否真的能做到，这个大家自己尝试，所以真的叫做初始赋值是否合适这个就见仁见智了，但是最起码的称之为赋值这个是没什么意义的估计。</p>
    <p>那么希望像jquery对象一样可以直接$(selector).val()来取值一样的使用form.val()？或者有没有其他办法在不需要点击lay-submit的情况下，不需要经过表单校验，就能够取到数据呢？这里提供一种实现方式，就是改造form.val，将submit的取值逻辑搬到form.val中去做。</p>
  </blockquote>
  <blockquote class="layui-elem-quote layui-quote-nm">
    <p>如何使用？</p>
    <p>实际这个jquery对象的val很想，具备两面手，有参数就是赋值没有参数就是取值，惬意~</p>
  </blockquote>
  <pre class="layui-code" lay-title="JavaScript" lay-encode="true">
util.event('lay-active', {
  getValue: function(){
    var elem = $(this);
    // var data = form.val(elem.next('form')); // 可以是一个jqueyr对象
    var data = form.val(elem.next('form').attr('lay-filter')); // 也可以是一个lay-filter的值
    layer.alert('data: ' + JSON.stringify(data));
  }
});</pre>
</div>